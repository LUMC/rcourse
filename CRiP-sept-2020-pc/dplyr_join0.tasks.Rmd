---
title: "Join (practice)"
# author: "R. Monajemi"
---

```{r , include=FALSE}
if (!is.null(knitr::opts_knit$get("solutions"))) {
  if (knitr::opts_knit$get("solutions")=="no") {
    knitr::opts_chunk$set(echo = FALSE, eval = FALSE, comment = NA, paged.print=FALSE)
  } else  {
    knitr::opts_chunk$set(echo = TRUE, eval = TRUE, comment = NA, paged.print=FALSE)
  }
} else {
    knitr::opts_chunk$set(echo = TRUE, eval = TRUE, comment = NA, paged.print=FALSE)
}

survey <- read_survey()
```


```{r, child="_exercises_format.Rmd",eval=TRUE,echo=FALSE} 
``` 

## Primary exercises

For this exercise we will first split  the `survey` dataset into two separate tables 
in order to join them again! Call these `df1` and `df2`, these will have disjoint set of 
variables except `name` and `age`, the variables `name` and `age` combined are unique in 
all observations and will be used later for joining. Take for example all variables related 
to arm or hand in df1 and the rest in df2:

```
df1 : "name"   "span1" "span2" "hand"  "fold"   "clap"  "age"
df2 : "name"   "gender"  "pulse"  "exercise"   "smokes"  "height" "m.i" "age"
```

```{r}
df1 <- survey %>%  select(name,age,span1,span2,hand,fold,clap)
df1
df2 <- survey %>%  select(name,age,gender,pulse,exercise,smokes,height,m.i)
df2
```

1. Join df1 and df2 by `name` and `age` such that you obtain the original survey table. 

```{r}
survey2 <- inner_join(df1,df2,by=c("name","age")) %>% 
  select(name,gender,span1,span2,hand,fold,pulse,clap,exercise,smokes,height,m.i,age)

```

2. Does it make any difference to choose either of `inner_join`, `left_join` and `full_join`? Hint: compare two tables with function `all_equal`.       

```{r}
# Answer is no, this because both df1 and df2 come from the same source 
# `survey` with equal number of observations and exact matching of the 
# keys. 
#

all_equal(left_join(df1,df2,by=c("name","age")), survey)   # left_join
all_equal(inner_join(df1,df2,by=c("name","age")), survey)  # inner_join
all_equal(full_join(df1,df2,by=c("name","age")), survey)   # full_join
```

3. Create the following tibbles (copy/paste):

```{r, echo=TRUE, eval=FALSE}
df1 <- tibble(name=c("Bobby","Gerald","Amelia","Lottie","Dennis"),
        height=c(179.1,NA,167.64,170,200), 
        age=c(18.917,16.917,17.333,17.25,18.5),
        span1=c(20,18,15.9,19,22))

df2 <- tibble(name=c("Bobby","Gerald","Amelia","Lottie","Dennis"),
        age=c(18.917,16.917,17.333,17.25,18.5),
        span2=c(19.5,13.3,16.5,18.5,21.5))

```
  
  
  
  -  Join df1 and df2 by `name`, do the same with `{name,age}`, explain the difference.
  
```{r}
# When joining only by 'name' we force the join function to resolve the name conflict age, it generated two columns 'age.x' and 'age.y' for df1$age and df2$age respectively.  
left_join(df1,df2, by="name")
```


```{r}
# There is no name conflict here, both 'name' and 'age' are as keys for joining and all other variables have uniqe names. 
left_join(df1,df2, by=c("name", "age"))
```
  

## Extra exercises