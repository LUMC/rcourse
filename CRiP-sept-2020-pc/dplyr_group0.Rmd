---
title: 'Group'
# author: "R. Monajemi"
params:
  basename: "dplyr_group0"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(comment = NA, paged.print=FALSE)
build_nocode(params)  # UNCOMMENT IF SLOT HAS TASKS.
pulse <- read_pulse()
```

```{r, echo=FALSE, results='asis'}
navigate_slots(params)
```

> Group observations into sets and summarise on those sets.


## `group_by` : group observations

You can group your data given a set of variables. For example we can group per `age` and `gender`: 

```{r}
pulse %>% group_by( age,gender )
```

Note the tag **Groups: age, gender [21]** in the output, meaning that `group_by` found 21 `{age,gender}` groups in
our dataset. 

Once groups are marked with `group_by`, then we can analyse those groups with `summarise` producing a single row output per group. For example we can count the number of observation per group using function `n()`: 

```{r, warning=FALSE}
pulse %>% group_by( age, gender ) %>% 
          summarise( n = n())
```

> Which function produces the same output as above given {age,gender}?

```{r, echo=FALSE, results='asis'}
msg <- "'count' function: <br><br>
puls %>% count(age,gnder)
<br><br>"
qa(msg)
```

But of course we want to do more than just count the groups. We can for example calculate the mean `height` and `weight` per `{age,gender}` group: 

```{r}
pulse %>% group_by(age,gender) %>% 
          summarise(count=n(),meanHeight=mean(height), meanWeight=mean(weight))
```

<!-- ======================================================= -->

## Queries

We are now have all the tools the we want to do more complext queries on our data. For example, group per `gender` on those that `ran` and summarize on mean `age`, `pulse1` and `pulse2`. First we need to filter only those who  *ran* (see explanation on `ran` in [pulse](data.html)) and only then group and summarise:  

```{r}
pulse %>% filter(ran == "ran") %>% 
          group_by( gender ) %>% 
          summarise( count = n(), meanAge= mean(age), meanPluse1 = mean(pulse1), meanPulse2 = mean( pulse2 ) )
```

now for those who `sat`:

```{r}
pulse %>% filter(ran == "sat") %>% group_by( gender ) %>% 
    summarise( count = n(), meanAge= mean(age), meanPluse1 = mean(pulse1), meanPulse2 = mean( pulse2 ) )
```

Note the there are missing values, account for it by using `na.rm=TRUE`:  

```{r}
pulse %>% filter(ran == "sat") %>% 
          group_by( gender ) %>% 
          summarise( count = n(), meanAge= mean(age), 
               meanPluse1 = mean(pulse1,na.rm=TRUE), meanPulse2 = mean( pulse2 , na.rm=TRUE) )
```

Use `ungroup` to remove grouping:

```{r}
pulse  %>% group_by( gender ) %>% ungroup()
```

<!-- ======================================================= -->


```{r, child="_exercises_links.Rmd"}
``` 

```{r, echo=FALSE, results='asis'}
navigate_slots(params)
```
